<!doctype html>
<html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width">
<title>Share Story</title></head><body style="font-family:Arial;padding:20px">
<div style="max-width:720px;margin:0 auto;background:#fff;padding:18px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,0.08)">
  <h2>Share Your Story</h2>
  <form id="storyForm">
    <input name="title" placeholder="Title" required style="width:100%;padding:10px;margin-top:8px">
    <textarea name="content" placeholder="Write your story..." required style="width:100%;height:160px;margin-top:8px;padding:10px"></textarea>
    <input name="hp" style="display:none">
    <button type="submit" style="margin-top:8px;padding:10px 16px;background:#5c2e91;color:#fff;border:none;border-radius:8px">Submit</button>
  </form>
  <div style="margin-top:12px;color:#666">Posts are reviewed by admin before appearing.</div>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxwgDfvh9ixawMDkXGrhYn8dA58mwpGOQRmfxPA4e1oKoa32kW9T2ETT9msDdbOb3Am/exec";
const SECRET_KEY = "v8YhT93NfZ2jP6mXcA7rL1kE5s";
function getFp(){ try{ return btoa(navigator.userAgent+"||"+screen.width+"x"+screen.height+"||"+Intl.DateTimeFormat().resolvedOptions().timeZone); }catch(e){return navigator.userAgent||"unk"} }

document.getElementById('storyForm').addEventListener('submit', async function(ev){
  ev.preventDefault();
  const token = localStorage.getItem("authToken");
  const email = localStorage.getItem("authEmail");
  if(!token || !email) { alert("Please login first"); window.location.href='login.html'; return; }
  const fd = new FormData(ev.target);
  fd.append("action","submitStory");
  fd.append("key", SECRET_KEY);
  fd.append("ref", window.location.origin);
  fd.append("fp", getFp());
  fd.append("hp", "");
  fd.append("token", token);
  fd.append("email", email);
  try{
    const r = await fetch(SCRIPT_URL, { method:"POST", body: fd });
    const text = await r.text();
    alert(text);
    if(text.includes("Success")) ev.target.reset();
  }catch(err){ alert("Network error"); }
});
</script>
</body></html>
