<!doctype html>
<html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width">
<title>Share Story</title></head><body style="font-family:Arial;padding:20px">
<div style="max-width:720px;margin:0 auto;background:#fff;padding:18px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,0.08)">
  <h2>Share Your Story</h2>
  <form id="storyForm">
    <input name="title" placeholder="Title" required style="width:100%;padding:10px;margin-top:8px">
    <textarea name="content" placeholder="Write your story..." required style="width:100%;height:160px;margin-top:8px;padding:10px"></textarea>
    <input name="hp" style="display:none">
    <button type="submit" style="margin-top:8px;padding:10px 16px;background:#5c2e91;color:#fff;border:none;border-radius:8px">Submit</button>
  </form>
  <div style="margin-top:12px;color:#666">Posts are reviewed by admin before appearing.</div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const userEmail = localStorage.getItem("userEmail");

  if (!userEmail) {
    alert("Please login first");
    window.location.href = "login.html";
    return;
  }

  // ✅ show email confirmation
  document.getElementById("welcomeText").textContent = `Welcome, ${userEmail}!`;

  // ✅ handle story posting
  const postBtn = document.getElementById("postBtn");
  postBtn.addEventListener("click", async () => {
    const story = document.getElementById("storyInput").value.trim();
    if (!story) {
      alert("Please write something before posting!");
      return;
    }

    const formData = new URLSearchParams();
    formData.append("action", "addStory");
    formData.append("email", userEmail);
    formData.append("story", story);
    formData.append("key", "v8YhT93NfZ2jP6mXcA7rL1kE5s");
    formData.append("origin", window.location.origin);

    try {
      const response = await fetch("https://script.google.com/macros/s/AKfycbzeHK6aNP-6z1c7T6X1H9JxGK5gMkR6umLPrATSgVqgg0MUV9kCK3_qwHPLn3IDU98E/exec", {
        method: "POST",
        body: formData
      });

      const text = await response.text();
      console.log("Server response:", text);

      if (text.includes("Success: Story Added")) {
        alert("✅ Story posted successfully!");
        document.getElementById("storyInput").value = "";
      } else {
        alert("❌ Failed to post. Please try again.");
      }
    } catch (err) {
      console.error(err);
      alert("⚠️ Network error. Please try again later.");
    }
  });
});
</script>

</script>
</body></html>
